(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{382:function(s,t,a){"use strict";a.r(t);var e=a(40),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"调试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调试"}},[s._v("#")]),s._v(" 调试")]),s._v(" "),a("p",[s._v("这里说明一些框架和模块的调试方法，比如终端输出 Log、下断点、运行测试单元等。")]),s._v(" "),a("h2",{attrs:{id:"下断点调试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下断点调试"}},[s._v("#")]),s._v(" 下断点调试")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("版本提示")]),s._v(" "),a("p",[s._v("下断点功能在 1.4 版本开始可用。")])]),s._v(" "),a("p",[s._v("框架支持了 Psysh 断点调试功能，你可以在任意位置方便地下断点进行调试。")]),s._v(" "),a("p",[s._v("众所周知，Swoole 不支持 xdebug 等扩展，所以对 Swoole 程序调试起来没有那么方便。但因为 Swoole 是运行到命令行的 PHP 程序，而命令行的 PHP 有非常著名的 REPL 环境——Psysh，和 Swoole 组合将可以很方便地下断点进行调试。")]),s._v(" "),a("p",[s._v("在启动框架前，你需要加上参数 "),a("code",[s._v("--debug-mode")]),s._v("，或者在最新版本框架里的 "),a("code",[s._v("config/global.php")]),s._v(" 文件中将 "),a("code",[s._v("$config['debug_mode']")]),s._v(" 改为 true。（如果你是从旧版本升级的框架，可能会没有此选项，手动加上即可。注意要是带参数启动的话，必须含有 "),a("code",[s._v("server")]),s._v(" 的命令选项，如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 普通方式启动")]),s._v("\nphp bin/start server --debug-mode\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Phar方式启动")]),s._v("\nphp server.phar server --debug-mode\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Composer 初始化项目启动")]),s._v("\nvendor/bin/start server --debug-mode\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("下断点一句话：")])]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("eval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ZM_BREAKPOINT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 或者简写：eval(BP);")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("比如你在代码中，可以以这样的方式下断点：")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('/**\n * @RequestMapping("/index")\n */')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Steve"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("eval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ZM_BREAKPOINT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getResponse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Your name: '),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")])]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("我们在断点处在终端内把 "),a("code",[s._v("$name")]),s._v(" 修改：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$name = "Bob"\nexit\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("继续执行输入 "),a("code",[s._v("exit")]),s._v(" 或 "),a("code",[s._v("q")]),s._v("，这里下好断点的地方你可以执行任何 PHP 代码，同时还可以使用 Psysh 支持的命令，详见 "),a("a",{attrs:{href:"https://psysh.org/#docs",target:"_blank",rel:"noopener noreferrer"}},[s._v("Psysh 文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("ol",[a("li",[s._v("断点位置在不开启 debug-mode 时不会有任何效果。")]),s._v(" "),a("li",[s._v("开启 debug-mode 后，原本的终端命令输入（如 logtest 等）会被关闭。")]),s._v(" "),a("li",[s._v("因为 Psysh 的终端与 Swoole 的一键协程化冲突，所以在以此模式启动后，"),a("a",{attrs:{href:"https://wiki.swoole.com/#/runtime",target:"_blank",rel:"noopener noreferrer"}},[s._v("Swoole 一键协程化"),a("OutboundLink")],1),s._v(" 将临时关闭。")])])]),s._v(" "),a("h2",{attrs:{id:"console-日志调试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#console-日志调试"}},[s._v("#")]),s._v(" Console 日志调试")]),s._v(" "),a("p",[s._v("框架默认情况下，日志等级为 2，也就是不显示 "),a("code",[s._v("verbose")]),s._v(" 和 "),a("code",[s._v("debug")]),s._v(" 级别的日志。你可以临时根据启动命令修改日志等级：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("php bin/start server --log-debug "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以debug最高级别显示所有输出")]),s._v("\nphp bin/start server --log-verbose "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示加载中间件、保存缓存等繁琐的日志输出")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);